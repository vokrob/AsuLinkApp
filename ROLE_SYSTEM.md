# Система ролей пользователей AsuLinkApp

## Описание

Система автоматического присвоения ролей пользователям на основе email адреса при регистрации.

## Роли пользователей

### 1. Студент (student)
- **Присваивается по умолчанию** всем пользователям
- **Поля профиля:**
  - Факультет (обязательно)
  - Группа (обязательно)
  - Курс (необязательно)

### 2. Преподаватель (professor)
- **Присваивается автоматически** если email находится в списке преподавателей
- **Поля профиля:**
  - Кафедра (обязательно)
  - Должность (обязательно)

### 3. Администратор (admin)
- **Присваивается вручную** через админ-панель Django

## Управление email преподавателей

### Добавление email преподавателя

```bash
cd backend
python manage.py add_teacher_email email@example.com --department "Название кафедры" --position "Должность"
```

**Пример:**
```bash
python manage.py add_teacher_email rem6637@gmail.com --department "Кафедра информационных технологий" --position "Доцент"
```

### Проверка пользователей и ролей

```bash
cd backend
python manage.py check_users
```

### Тестирование системы ролей

```bash
cd backend
python manage.py test_role_system
```

## Как работает система

1. **При регистрации пользователя:**
   - Система проверяет email в таблице `TeacherEmail`
   - Если email найден → роль "Преподаватель"
   - Если email не найден → роль "Студент"

2. **При заполнении профиля:**
   - Мобильное приложение получает роль пользователя от сервера
   - Показывает соответствующие поля для заполнения
   - Валидирует обязательные поля в зависимости от роли

3. **В интерфейсе:**
   - Отображается роль пользователя
   - Показываются только релевантные поля
   - Разная валидация для разных ролей

### Поля для заполнения

**Для преподавателей:**
- ФИО (обязательно)
- Кафедра (обязательно)
- Должность (обязательно)

**Для студентов:**
- ФИО (обязательно)
- Факультет (обязательно)
- Группа (обязательно)
- Курс (необязательно)

## API эндпоинты

- `GET /api/auth/me/` - Получение информации о текущем пользователе (включая роль)
- `GET /api/profile/` - Профиль пользователя
- `PUT /api/profile/` - Обновление профиля

## Структура данных

### UserProfile модель
```python
role = models.CharField(choices=[
    ('student', 'Студент'),
    ('professor', 'Преподаватель'),
    ('admin', 'Администратор'),
])

# Поля для студентов
faculty = models.CharField(max_length=200, blank=True)
group = models.CharField(max_length=50, blank=True)
course = models.IntegerField(null=True, blank=True)

# Поля для преподавателей
department = models.CharField(max_length=200, blank=True)
position = models.CharField(max_length=100, blank=True)
```

### TeacherEmail модель
```python
email = models.EmailField(unique=True)
department = models.CharField(max_length=200, blank=True)
position = models.CharField(max_length=100, blank=True)
is_active = models.BooleanField(default=True)
```

## Примеры использования

### Добавление нескольких преподавателей
```bash
python manage.py add_teacher_email prof1@asu.edu.ru --department "Кафедра математики" --position "Профессор"
python manage.py add_teacher_email prof2@asu.edu.ru --department "Кафедра физики" --position "Доцент"
python manage.py add_teacher_email admin@asu.edu.ru --department "Администрация" --position "Декан"
```

### Проверка работы системы
1. Зарегистрируйтесь с email из списка преподавателей
2. Проверьте, что роль автоматически установилась как "Преподаватель"
3. При заполнении профиля должны появиться поля для преподавателей

## Администрирование

В Django Admin доступны:
- **Профили пользователей** - просмотр и редактирование ролей
- **Email преподавателей** - управление списком email адресов
- Фильтрация по ролям и кафедрам
- Поиск по email и именам

## Безопасность

- Email преподавателей можно деактивировать (is_active=False)
- Роли можно изменять только через админ-панель
- Автоматическое присвоение ролей происходит только при регистрации
